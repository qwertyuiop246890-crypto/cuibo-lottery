<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è¨‚å–®ç·¨è™Ÿè¼¸å‡ºï¼†æœ‰æ•ˆåå–®ç”¢ç”Ÿå™¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --main: #afc9d9;
      --dark: #2b3e50;
      --light: #f7fafc;
      --border: #d0dbe3;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(180deg, var(--main) 0%, #eef4f8 40%, #ffffff 100%);
      padding: 24px 12px 40px;
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      background: white;
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      padding: 20px 18px 28px;
    }

    @media (min-width: 768px) {
      .page {
        padding: 24px 24px 32px;
      }
    }

    h1 {
      margin: 0 0 4px;
      font-size: 1.5rem;
      color: var(--dark);
    }

    .subtitle {
      font-size: 0.9rem;
      color: #5a6a7a;
      margin-bottom: 18px;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }

    .tab-btn {
      border: 1px solid var(--border);
      background: #f5f8fb;
      color: #445569;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .tab-btn.active {
      background: var(--dark);
      color: #fff;
      border-color: var(--dark);
    }

    .tab-btn span.icon {
      font-size: 1rem;
    }

    .tab {
      display: none;
    }

    .tab.active {
      display: block;
    }

    .card {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px 14px 16px;
      background: var(--light);
      margin-bottom: 16px;
    }

    .card h2 {
      margin: 0 0 6px;
      font-size: 1.1rem;
      color: var(--dark);
    }

    .card p.desc {
      margin: 0 0 10px;
      font-size: 0.85rem;
      color: #566677;
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 6px;
      color: #344255;
    }

    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.85rem;
      background: #ffffff;
      min-height: 140px;
    }

    .row {
      display: grid;
      gap: 12px;
    }

    @media (min-width: 768px) {
      .row.two {
        grid-template-columns: 1.1fr 1fr;
      }
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      background: var(--dark);
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    button.secondary {
      background: #f5f8fb;
      color: #324256;
      border: 1px solid var(--border);
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
      margin-bottom: 6px;
    }

    .stat {
      font-size: 0.85rem;
      color: #445569;
      margin-top: 4px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.8rem;
      background: rgba(175,201,217,0.2);
      color: #324256;
      margin-right: 4px;
      margin-bottom: 4px;
    }

    .pill.bad {
      background: rgba(239,68,68,0.12);
      color: #b91c1c;
    }

    .pill.good {
      background: rgba(16,185,129,0.16);
      color: #047857;
    }

    .list {
      font-size: 0.85rem;
      margin-top: 6px;
    }

    .list ul {
      margin: 4px 0 0 18px;
      padding: 0;
    }

    .muted {
      color: #6b7280;
      font-size: 0.8rem;
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>è¨‚å–®ç·¨è™Ÿè¼¸å‡ºï¼†æœ‰æ•ˆåå–®ç”¢ç”Ÿå™¨</h1>
    <div class="subtitle">
      ä¸Šé¢ï¼š<strong>è¨‚å–®æ¸…å–® âœ orderIds.json ï¼‹ ç´”è¨‚å–®æ¸…å–®</strong>ï¼›<br>
      ä¸‹é¢ï¼š<strong>å ±åè³‡æ–™ âœ æœ‰æ•ˆåå–®ï¼ˆTab åˆ†éš”ï¼Œå¯è²¼å›è©¦ç®—è¡¨ï¼‰</strong>ã€‚
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="json">
        <span class="icon">ğŸ“„</span><span>è¨‚å–®JSONç”¢ç”Ÿå™¨</span>
      </button>
      <button class="tab-btn" data-tab="clean">
        <span class="icon">ğŸ“‹</span><span>æœ‰æ•ˆåå–®æ•´ç†</span>
      </button>
    </div>

    <!-- Tab 1: è¨‚å–® JSON & ç´”è¨‚å–®æ¸…å–® -->
    <section class="tab active" id="tab-json">
      <div class="card">
        <h2>è¨‚å–®æ¸…å–® âœ orderIds.json ï¼‹ ç´”è¨‚å–®æ¸…å–®</h2>
        <p class="desc">
          å¾è©¦ç®—è¡¨æˆ– Excel è¤‡è£½æ‰€æœ‰ã€Œè¨‚å–®ç·¨è™Ÿã€è²¼åˆ°å·¦é‚Šï¼Œç³»çµ±æœƒï¼š
          <br>å»æ‰ç©ºç™½è¡Œ âœ è‡ªå‹•å»é‡ âœ åŒæ™‚ç”¢ç”Ÿ
          <strong>orderIds.json å…§å®¹</strong>ï¼‹<strong>ç´”è¨‚å–®æ¸…å–®ï¼ˆæ¯è¡Œä¸€ç­†ï¼Œå¯ç›´æ¥è²¼å› Excelï¼‰</strong>ã€‚
        </p>
        <div class="row two">
          <div>
            <label for="ordersInput">è²¼ä¸Šè¨‚å–®ç·¨è™Ÿï¼ˆæ¯è¡Œä¸€ç­†ï¼‰ï¼š</label>
            <textarea id="ordersInput" placeholder="ä¾‹å¦‚ï¼š
2511090201AFQWYC
2511090411V7UZ3S
2511091021ST8T3P"></textarea>
            <div class="btn-group">
              <button type="button" id="btn-gen-json">ç”¢ç”Ÿçµæœ</button>
              <button type="button" class="secondary" id="btn-clear-orders">æ¸…é™¤</button>
            </div>
            <div class="stat" id="ordersStat"></div>
          </div>
          <div>
            <label for="ordersOutputJson">ç”¢ç”Ÿçµæœï¼ˆorderIds.json å…§å®¹ï¼‰ï¼š</label>
            <textarea id="ordersOutputJson" readonly>{}</textarea>

            <label for="ordersOutputPlain" style="margin-top:10px;">ç´”è¨‚å–®æ¸…å–®ï¼ˆæ¯è¡Œä¸€ç­†ï¼Œå¯ç›´æ¥è²¼å› Excelï¼‰ï¼š</label>
            <textarea id="ordersOutputPlain" readonly placeholder="å»é‡å¾Œçš„è¨‚å–®ç·¨è™Ÿæœƒå‡ºç¾åœ¨é€™è£¡ï¼Œæ¯è¡Œä¸€ç­†ã€‚"></textarea>

            <div class="btn-group">
              <button type="button" class="secondary" id="btn-copy-json">è¤‡è£½ JSON</button>
              <button type="button" class="secondary" id="btn-copy-plain">è¤‡è£½è¨‚å–®æ¸…å–®</button>
            </div>
            <div class="muted">
              JSON è²¼åˆ° GitHub çš„ <code>orderIds.json</code>ï¼›<br>
              ã€Œç´”è¨‚å–®æ¸…å–®ã€å¯ä»¥ç›´æ¥è²¼å› Excelï¼Œä¸€åˆ—ä¸€ç­†ï¼Œä¸æœƒæœ‰åˆä½µå„²å­˜æ ¼å•é¡Œã€‚
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tab 2: æœ‰æ•ˆåå–®æ•´ç†ï¼ˆä¿ç•™ä¹‹å‰çš„é‚è¼¯ï¼‰ -->
    <section class="tab" id="tab-clean">
      <div class="card">
        <h2>å ±åè³‡æ–™ âœ æœ‰æ•ˆåå–®ï¼ˆTab åˆ†éš”ï¼‰</h2>
        <p class="desc">
          å»ºè­°æµç¨‹ï¼šåœ¨ Google è©¦ç®—è¡¨çš„ã€ŒæŠ½çå ±åã€é ï¼Œå…ˆç¯©é¸å‡º <strong>ç‹€æ…‹ = æœ‰æ•ˆ</strong>ï¼Œ
          å†è¤‡è£½ã€Œè¨‚å–®ç·¨è™Ÿ + ç¤¾ç¾¤åç¨±ã€å…©æ¬„è²¼åˆ°ä¸‹é¢ã€‚<br>
          ç³»çµ±æœƒï¼š
          <br>âœ å»æ‰ç©ºç™½åˆ—
          <br>âœ <strong>è¨‚å–®ç·¨è™Ÿé‡è¤‡</strong>ï¼šåªä¿ç•™ç¬¬ä¸€ç­†
          <br>âœ <strong>ç¤¾ç¾¤åç¨±é‡è¤‡</strong>ï¼ˆéç©ºç™½ï¼‰ï¼šåªä¿ç•™ç¬¬ä¸€ç­†
        </p>

        <label for="entryInput">è²¼ä¸Šè³‡æ–™ï¼ˆæ¯è¡Œï¼šè¨‚å–®ç·¨è™Ÿï¼‹ç¤¾ç¾¤åï¼Œå¯ç”¨é€—è™Ÿã€ç©ºç™½æˆ– Tab åˆ†éš”ï¼‰ï¼š</label>
        <textarea id="entryInput" placeholder="ä¾‹å¦‚ï¼š
2511090201AFQWYC, @user1
2511090411V7UZ3S, @user2
2511090201AFQWYC, @user1   â† é‡è¤‡è¨‚å–®
2511090500ABCDE3, @user2   â† é‡è¤‡ç¤¾ç¾¤åç¨±"></textarea>

        <div class="btn-group">
          <button type="button" id="btn-prepare">æ•´ç†è³‡æ–™</button>
          <button type="button" class="secondary" id="btn-clear-entry">æ¸…é™¤</button>
        </div>
        <div class="stat" id="entryStat"></div>
      </div>

      <div class="card">
        <h2>æœ‰æ•ˆåå–®ï¼ˆTab åˆ†éš”ï¼Œå¯ç›´æ¥è²¼å›è©¦ç®—è¡¨å…©æ¬„ï¼‰</h2>
        <div class="btn-group">
          <span class="pill good" id="pill-valid">æœ‰æ•ˆç­†æ•¸ï¼š0</span>
          <span class="pill.bad" id="pill-dup">è¢«å‰”é™¤ç­†æ•¸ï¼š0</span>
        </div>
        <label for="validOutput">æœ‰æ•ˆåå–®ï¼š</label>
        <textarea id="validOutput" readonly placeholder="æ•´ç†å¾Œçš„æœ‰æ•ˆåå–®æœƒå‡ºç¾åœ¨é€™è£¡ã€‚
æ ¼å¼ï¼šè¨‚å–®ç·¨è™Ÿ[TAB]ç¤¾ç¾¤åç¨±"></textarea>
        <div class="btn-group">
          <button type="button" id="btn-copy-valid">è¤‡è£½æœ‰æ•ˆåå–®</button>
        </div>
        <div class="muted">
          è²¼å› Excel / è©¦ç®—è¡¨æ™‚ï¼Œæ¯è¡Œæœƒè‡ªå‹•åˆ†æˆå…©æ¬„ï¼ˆè¨‚å–®ç·¨è™Ÿ / ç¤¾ç¾¤åç¨±ï¼‰ã€‚
        </div>
      </div>

      <div class="card">
        <h2>è¢«å‰”é™¤çš„é‡è¤‡ç´€éŒ„</h2>
        <div class="list" id="dupListWrap" style="display:none;">
          <ul id="dupList"></ul>
        </div>
        <div class="muted" id="dupEmptyHint">
          ç›®å‰æ²’æœ‰é‡è¤‡ç´€éŒ„ã€‚
        </div>
      </div>
    </section>
  </div>

  <script>
    // --- Tab åˆ‡æ› ---
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabs = document.querySelectorAll('.tab');
    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        tabButtons.forEach(b => b.classList.remove('active'));
        tabs.forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
      });
    });

    // --- è¨‚å–® JSON & ç´”æ¸…å–® ---
    const ordersInput = document.getElementById('ordersInput');
    const ordersOutputJson = document.getElementById('ordersOutputJson');
    const ordersOutputPlain = document.getElementById('ordersOutputPlain');
    const ordersStat = document.getElementById('ordersStat');
    const btnGenJson = document.getElementById('btn-gen-json');
    const btnClearOrders = document.getElementById('btn-clear-orders');
    const btnCopyJson = document.getElementById('btn-copy-json');
    const btnCopyPlain = document.getElementById('btn-copy-plain');

    btnGenJson.addEventListener('click', () => {
      const rawLines = ordersInput.value.split(/\r?\n/).map(l => l.trim());
      const nonEmpty = rawLines.filter(l => l !== '');
      const seen = new Set();
      const unique = [];
      for (const id of nonEmpty) {
        if (!seen.has(id)) {
          seen.add(id);
          unique.push(id);
        }
      }
      const json = JSON.stringify({ orders: unique }, null, 2);
      ordersOutputJson.value = json;
      ordersOutputPlain.value = unique.join('\n');
      ordersStat.textContent = `è²¼ä¸Š ${nonEmpty.length} ç­†ï¼Œå»é‡å¾Œå‰© ${unique.length} ç­†ã€‚`;
    });

    btnClearOrders.addEventListener('click', () => {
      ordersInput.value = '';
      ordersOutputJson.value = '{}';
      ordersOutputPlain.value = '';
      ordersStat.textContent = '';
    });

    btnCopyJson.addEventListener('click', async () => {
      const text = ordersOutputJson.value.trim();
      if (!text || text === '{}') return;
      try {
        await navigator.clipboard.writeText(text);
        btnCopyJson.textContent = 'å·²è¤‡è£½ âœ”';
        setTimeout(() => btnCopyJson.textContent = 'è¤‡è£½ JSON', 1200);
      } catch (e) {
        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å– JSON å¾Œè¤‡è£½ã€‚');
      }
    });

    btnCopyPlain.addEventListener('click', async () => {
      const text = ordersOutputPlain.value.trim();
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        btnCopyPlain.textContent = 'å·²è¤‡è£½ âœ”';
        setTimeout(() => btnCopyPlain.textContent = 'è¤‡è£½è¨‚å–®æ¸…å–®', 1200);
      } catch (e) {
        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–è¨‚å–®æ¸…å–®å¾Œè¤‡è£½ã€‚');
      }
    });

    // --- æœ‰æ•ˆåå–®æ•´ç†ï¼ˆè·Ÿä¹‹å‰é‚è¼¯ç›¸åŒï¼‰ ---
    const entryInput = document.getElementById('entryInput');
    const entryStat = document.getElementById('entryStat');
    const btnPrepare = document.getElementById('btn-prepare');
    const btnClearEntry = document.getElementById('btn-clear-entry');
    const validOutput = document.getElementById('validOutput');
    const btnCopyValid = document.getElementById('btn-copy-valid');
    const pillValid = document.getElementById('pill-valid');
    const pillDup = document.getElementById('pill-dup');
    const dupListWrap = document.getElementById('dupListWrap');
    const dupList = document.getElementById('dupList');
    const dupEmptyHint = document.getElementById('dupEmptyHint');

    let cleanEntries = [];
    let dupEntries = [];

    btnPrepare.addEventListener('click', () => {
      const lines = entryInput.value.split(/\r?\n/);
      const records = [];

      for (const raw of lines) {
        const line = raw.trim();
        if (!line) continue;
        if (line.includes('è¨‚å–®') && line.includes('ç¤¾ç¾¤')) continue;

        const parts = line.split(/[\t,ï¼Œ ]+/).filter(x => x !== '');
        if (parts.length === 0) continue;
        const orderId = (parts[0] || '').trim();
        const snsName = (parts[1] || '').trim();
        if (!orderId) continue;
        records.push({ orderId, snsName, raw: line });
      }

      const orderMap = new Map();
      const snsMap = new Map();
      cleanEntries = [];
      dupEntries = [];

      for (const rec of records) {
        const orderKey = rec.orderId;
        const snsKey = (rec.snsName || '').trim();

        let reason = '';

        if (orderMap.has(orderKey)) {
          reason = 'order';
        } else if (snsKey && snsMap.has(snsKey)) {
          reason = 'sns';
        }

        if (reason) {
          dupEntries.push({ ...rec, reason });
        } else {
          cleanEntries.push(rec);
          orderMap.set(orderKey, rec);
          if (snsKey) snsMap.set(snsKey, rec);
        }
      }

      entryStat.textContent =
        `åŸå§‹å…± ${records.length} ç­†ï¼Œå»æ‰ç©ºç™½å¾Œ ${records.length} ç­†ï¼Œ` +
        `ä»¥ã€Œè¨‚å–®ç·¨è™Ÿ + ç¤¾ç¾¤åç¨±ã€å»é‡å¾Œæœ‰æ•ˆåå–® ${cleanEntries.length} ç­†ã€‚`;

      pillValid.textContent = `æœ‰æ•ˆç­†æ•¸ï¼š${cleanEntries.length}`;
      pillDup.textContent = `è¢«å‰”é™¤ç­†æ•¸ï¼š${dupEntries.length}`;

      const linesOut = cleanEntries.map(rec => {
        const sns = rec.snsName || '';
        return `${rec.orderId}\t${sns}`;
      });
      validOutput.value = linesOut.join('\n');

      if (dupEntries.length > 0) {
        dupListWrap.style.display = '';
        dupEmptyHint.style.display = 'none';
        dupList.innerHTML = '';
        dupEntries.forEach(rec => {
          const li = document.createElement('li');
          const tag =
            rec.reason === 'sns'
              ? 'ï¼ˆç¤¾ç¾¤åç¨±é‡è¤‡ï¼‰'
              : 'ï¼ˆè¨‚å–®ç·¨è™Ÿé‡è¤‡ï¼‰';
          li.textContent = `${rec.orderId}ã€€${rec.snsName || ''} ${tag}`;
          dupList.appendChild(li);
        });
      } else {
        dupListWrap.style.display = 'none';
        dupList.innerHTML = '';
        dupEmptyHint.style.display = '';
      }
    });

    btnClearEntry.addEventListener('click', () => {
      entryInput.value = '';
      entryStat.textContent = '';
      pillValid.textContent = 'æœ‰æ•ˆç­†æ•¸ï¼š0';
      pillDup.textContent = 'è¢«å‰”é™¤ç­†æ•¸ï¼š0';
      validOutput.value = '';
      dupListWrap.style.display = 'none';
      dupList.innerHTML = '';
      dupEmptyHint.style.display = '';
    });

    btnCopyValid.addEventListener('click', async () => {
      const text = validOutput.value.trim();
      if (!text) return;
      try {
        await navigator.clipboard.writeText(text);
        btnCopyValid.textContent = 'å·²è¤‡è£½ âœ”';
        setTimeout(() => btnCopyValid.textContent = 'è¤‡è£½æœ‰æ•ˆåå–®', 1200);
      } catch (e) {
        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–å…§å®¹è¤‡è£½ã€‚');
      }
    });
  </script>
</body>
</html>
