<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æŠ½çç®¡ç†å·¥å…·</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --main: #afc9d9;
      --dark: #2b3e50;
      --light: #f7fafc;
      --border: #d0dbe3;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(180deg, var(--main) 0%, #eef4f8 40%, #ffffff 100%);
      padding: 24px 12px 40px;
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      background: white;
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      padding: 20px 18px 28px;
    }

    @media (min-width: 768px) {
      .page {
        padding: 24px 24px 32px;
      }
    }

    h1 {
      margin: 0 0 4px;
      font-size: 1.5rem;
      color: var(--dark);
    }

    .subtitle {
      font-size: 0.9rem;
      color: #5a6a7a;
      margin-bottom: 18px;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }

    .tab-btn {
      border: 1px solid var(--border);
      background: #f5f8fb;
      color: #445569;
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .tab-btn.active {
      background: var(--dark);
      color: #fff;
      border-color: var(--dark);
    }

    .tab-btn span.icon {
      font-size: 1rem;
    }

    .tab {
      display: none;
    }

    .tab.active {
      display: block;
    }

    .card {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px 14px 16px;
      background: var(--light);
      margin-bottom: 16px;
    }

    .card h2 {
      margin: 0 0 6px;
      font-size: 1.1rem;
      color: var(--dark);
    }

    .card p.desc {
      margin: 0 0 10px;
      font-size: 0.85rem;
      color: #566677;
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 6px;
      color: #344255;
    }

    textarea, input[type="number"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.85rem;
      background: #ffffff;
    }

    textarea {
      min-height: 140px;
    }

    .row {
      display: grid;
      gap: 12px;
    }

    @media (min-width: 768px) {
      .row.two {
        grid-template-columns: 1.1fr 1fr;
      }
      .row.three {
        grid-template-columns: 1.1fr 0.9fr;
      }
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.9rem;
      cursor: pointer;
      background: var(--dark);
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    button.secondary {
      background: #f5f8fb;
      color: #324256;
      border: 1px solid var(--border);
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
      margin-bottom: 6px;
    }

    .stat {
      font-size: 0.85rem;
      color: #445569;
      margin-top: 4px;
    }

    pre {
      background: #111827;
      color: #e5e7eb;
      padding: 10px;
      border-radius: 10px;
      overflow-x: auto;
      font-size: 0.8rem;
      margin: 6px 0 0;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.8rem;
      background: rgba(175,201,217,0.2);
      color: #324256;
      margin-right: 4px;
      margin-bottom: 4px;
    }

    .pill.bad {
      background: rgba(239,68,68,0.12);
      color: #b91c1c;
    }

    .pill.good {
      background: rgba(16,185,129,0.16);
      color: #047857;
    }

    .list {
      font-size: 0.85rem;
      margin-top: 6px;
    }

    .list ul, .list ol {
      margin: 4px 0 0 18px;
      padding: 0;
    }

    .muted {
      color: #6b7280;
      font-size: 0.8rem;
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>æŠ½çç®¡ç†å·¥å…·</h1>
    <div class="subtitle">
      é€™ä¸€é åªæœ‰è‡ªå·±ç”¨ï¼šä¸Šé¢åš <strong>è¨‚å–®æ¸…å–® â†’ orderIds.json</strong>ï¼Œä¸‹é¢åš <strong>å ±åæ•´ç† + æŠ½ç</strong>ã€‚
    </div>

    <div class="tabs">
      <button class="tab-btn active" data-tab="json">
        <span class="icon">ğŸ§¾</span><span>è¨‚å–® JSON ç”¢ç”Ÿå™¨</span>
      </button>
      <button class="tab-btn" data-tab="lottery">
        <span class="icon">ğŸ²</span><span>å ±åæ•´ç† & æŠ½ç</span>
      </button>
    </div>

    <section class="tab active" id="tab-json">
      <div class="card">
        <h2>è¨‚å–®æ¸…å–® âœ orderIds.json</h2>
        <p class="desc">
          å¾è©¦ç®—è¡¨æˆ– Excel è¤‡è£½æ‰€æœ‰ã€Œè¨‚å–®ç·¨è™Ÿã€è²¼åˆ°å·¦é‚Šï¼Œç³»çµ±æœƒï¼š
          <br>å»æ‰ç©ºç™½è¡Œ âœ è‡ªå‹•å»é‡ âœ ç”¢ç”Ÿå¯ä»¥ç›´æ¥è²¼é€² <code>orderIds.json</code> çš„å…§å®¹ã€‚
        </p>
        <div class="row two">
          <div>
            <label for="ordersInput">è²¼ä¸Šè¨‚å–®ç·¨è™Ÿï¼ˆæ¯è¡Œä¸€ç­†ï¼‰ï¼š</label>
            <textarea id="ordersInput" placeholder="ä¾‹å¦‚ï¼š
2511090201AFQWYC
2511090411V7UZ3S
2511091021ST8T3P"></textarea>
            <div class="btn-group">
              <button type="button" id="btn-gen-json">ç”¢ç”Ÿ JSON</button>
              <button type="button" class="secondary" id="btn-clear-orders">æ¸…é™¤</button>
            </div>
            <div class="stat" id="ordersStat"></div>
          </div>
          <div>
            <label>ç”¢ç”Ÿçµæœï¼ˆorderIds.json å…§å®¹ï¼‰ï¼š</label>
            <pre id="ordersOutput">{}</pre>
            <div class="btn-group">
              <button type="button" class="secondary" id="btn-copy-json">è¤‡è£½ JSON</button>
            </div>
            <div class="muted">
              è²¼åˆ° GitHub çš„ <code>orderIds.json</code> è£¡ï¼Œè¨˜å¾— Commitã€‚
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="tab" id="tab-lottery">
      <div class="card">
        <h2>å ±åè³‡æ–™æ•´ç†</h2>
        <p class="desc">
          å»ºè­°æµç¨‹ï¼šåœ¨ Google è©¦ç®—è¡¨çš„ã€ŒæŠ½çå ±åã€é ï¼Œå…ˆç¯©é¸å‡º <strong>ç‹€æ…‹ = æœ‰æ•ˆ</strong>ï¼Œ
          å†è¤‡è£½ã€Œè¨‚å–®ç·¨è™Ÿ + ç¤¾ç¾¤åç¨±ã€å…©æ¬„è²¼åˆ°ä¸‹é¢ï¼Œç³»çµ±æœƒè‡ªå‹•ï¼š
          <br>âœ å»æ‰ç©ºç™½åˆ—ã€€âœ ä»¥è¨‚å–®ç·¨è™Ÿå»é‡ï¼ˆåªä¿ç•™ç¬¬ä¸€ç­†ï¼‰ã€€âœ å¹«ä½ çµ±è¨ˆé‡è¤‡è¨‚å–®ã€‚
        </p>
        <label for="entryInput">è²¼ä¸Šè³‡æ–™ï¼ˆæ¯è¡Œï¼šè¨‚å–®ç·¨è™Ÿï¼‹ç¤¾ç¾¤åï¼Œå¯ä»¥ç”¨é€—è™Ÿã€ç©ºç™½æˆ– Tab åˆ†éš”ï¼‰ï¼š</label>
        <textarea id="entryInput" placeholder="ä¾‹å¦‚ï¼š
2511090201AFQWYC, @user1
2511090411V7UZ3S, @user2
2511090201AFQWYC, @user1   â† é‡è¤‡æœƒè‡ªå‹•è¢«å‰”é™¤"></textarea>

        <div class="btn-group">
          <button type="button" id="btn-prepare">æ•´ç†è³‡æ–™</button>
          <button type="button" class="secondary" id="btn-clear-entry">æ¸…é™¤</button>
        </div>
        <div class="stat" id="entryStat"></div>
      </div>

      <div class="card">
        <h2>æŠ½çè¨­å®š & çµæœ</h2>
        <div class="row three">
          <div>
            <label for="winnerCount">è¦æŠ½å‡ºå¹¾ä½å¾—çè€…ï¼š</label>
            <input type="number" id="winnerCount" min="1" value="3" />
            <div class="btn-group">
              <button type="button" id="btn-draw" disabled>é–‹å§‹æŠ½ç ğŸ²</button>
            </div>
            <div class="stat">
              <span class="pill good" id="pill-valid">æœ‰æ•ˆäººæ•¸ï¼š0</span>
              <span class="pill bad" id="pill-dup">é‡è¤‡è¨‚å–®ï¼š0</span>
            </div>
          </div>
          <div class="list">
            <strong>å¾—çåå–®ï¼š</strong>
            <ol id="winnerList"></ol>
            <div class="muted" id="winnerHint">å…ˆæ•´ç†è³‡æ–™å¾Œæ‰èƒ½æŠ½çã€‚</div>
          </div>
        </div>
        <div class="list" id="dupListWrap" style="margin-top:10px; display:none;">
          <strong>è¢«å‰”é™¤çš„é‡è¤‡è¨‚å–®ï¼ˆåªä¿ç•™ç¬¬ä¸€ç­†ï¼‰ï¼š</strong>
          <ul id="dupList"></ul>
        </div>
      </div>
    </section>
  </div>

  <script>
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabs = document.querySelectorAll('.tab');
    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        tabButtons.forEach(b => b.classList.remove('active'));
        tabs.forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
      });
    });

    const ordersInput = document.getElementById('ordersInput');
    const ordersOutput = document.getElementById('ordersOutput');
    const ordersStat = document.getElementById('ordersStat');
    const btnGenJson = document.getElementById('btn-gen-json');
    const btnClearOrders = document.getElementById('btn-clear-orders');
    const btnCopyJson = document.getElementById('btn-copy-json');

    btnGenJson.addEventListener('click', () => {
      const rawLines = ordersInput.value.split(/\r?\n/).map(l => l.trim());
      const nonEmpty = rawLines.filter(l => l !== '');
      const seen = new Set();
      const unique = [];
      for (const id of nonEmpty) {
        if (!seen.has(id)) {
          seen.add(id);
          unique.push(id);
        }
      }
      const json = JSON.stringify({ orders: unique }, null, 2);
      ordersOutput.textContent = json;
      ordersStat.textContent = `è²¼ä¸Š ${nonEmpty.length} ç­†ï¼Œå»é‡å¾Œå‰© ${unique.length} ç­†ã€‚`;
    });

    btnClearOrders.addEventListener('click', () => {
      ordersInput.value = '';
      ordersOutput.textContent = '{}';
      ordersStat.textContent = '';
    });

    btnCopyJson.addEventListener('click', async () => {
      const text = ordersOutput.textContent.trim();
      if (!text || text === '{}') return;
      try {
        await navigator.clipboard.writeText(text);
        btnCopyJson.textContent = 'å·²è¤‡è£½ âœ”';
        setTimeout(() => btnCopyJson.textContent = 'è¤‡è£½ JSON', 1200);
      } catch (e) {
        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–è¤‡è£½ã€‚');
      }
    });

    const entryInput = document.getElementById('entryInput');
    const entryStat = document.getElementById('entryStat');
    const btnPrepare = document.getElementById('btn-prepare');
    const btnClearEntry = document.getElementById('btn-clear-entry');
    const btnDraw = document.getElementById('btn-draw');
    const winnerCountInput = document.getElementById('winnerCount');
    const winnerList = document.getElementById('winnerList');
    const winnerHint = document.getElementById('winnerHint');
    const pillValid = document.getElementById('pill-valid');
    const pillDup = document.getElementById('pill-dup');
    const dupListWrap = document.getElementById('dupListWrap');
    const dupList = document.getElementById('dupList');

    let cleanEntries = [];
    let dupEntries = [];

    btnPrepare.addEventListener('click', () => {
      const lines = entryInput.value.split(/\r?\n/);
      const records = [];
      for (const raw of lines) {
        const line = raw.trim();
        if (!line) continue;
        if (line.includes('è¨‚å–®') && line.includes('ç¤¾ç¾¤')) continue;

        const parts = line.split(/[\t,ï¼Œ ]+/).filter(x => x !== '');
        if (parts.length === 0) continue;
        const orderId = (parts[0] || '').trim();
        const snsName = (parts[1] || '').trim();
        if (!orderId) continue;
        records.push({ orderId, snsName, raw: line });
      }

      const map = new Map();
      cleanEntries = [];
      dupEntries = [];

      for (const rec of records) {
        if (!map.has(rec.orderId)) {
          map.set(rec.orderId, rec);
          cleanEntries.push(rec);
        } else {
          dupEntries.push(rec);
        }
      }

      entryStat.textContent =
        `åŸå§‹å…± ${records.length} ç­†ï¼Œå»æ‰ç©ºç™½å¾Œ ${records.length} ç­†ï¼Œ` +
        `ä»¥è¨‚å–®ç·¨è™Ÿå»é‡å¾Œå¯æŠ½çåå–® ${cleanEntries.length} ç­†ã€‚`;

      pillValid.textContent = `æœ‰æ•ˆäººæ•¸ï¼š${cleanEntries.length}`;
      pillDup.textContent = `é‡è¤‡è¨‚å–®ï¼š${dupEntries.length}`;

      if (dupEntries.length > 0) {
        dupListWrap.style.display = '';
        dupList.innerHTML = '';
        dupEntries.forEach(rec => {
          const li = document.createElement('li');
          li.textContent = `${rec.orderId}ã€€${rec.snsName || ''}`;
          dupList.appendChild(li);
        });
      } else {
        dupListWrap.style.display = 'none';
        dupList.innerHTML = '';
      }

      winnerList.innerHTML = '';
      winnerHint.textContent = 'è³‡æ–™å·²æ•´ç†ï¼Œå¯ä»¥è¨­å®šäººæ•¸å¾ŒæŒ‰ã€Œé–‹å§‹æŠ½çã€ã€‚';
      btnDraw.disabled = cleanEntries.length === 0;
    });

    btnClearEntry.addEventListener('click', () => {
      entryInput.value = '';
      entryStat.textContent = '';
      pillValid.textContent = 'æœ‰æ•ˆäººæ•¸ï¼š0';
      pillDup.textContent = 'é‡è¤‡è¨‚å–®ï¼š0';
      dupListWrap.style.display = 'none';
      dupList.innerHTML = '';
      winnerList.innerHTML = '';
      winnerHint.textContent = 'å…ˆæ•´ç†è³‡æ–™å¾Œæ‰èƒ½æŠ½çã€‚';
      btnDraw.disabled = true;
    });

    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    btnDraw.addEventListener('click', () => {
      const n = parseInt(winnerCountInput.value, 10) || 0;
      if (!cleanEntries.length) {
        alert('è«‹å…ˆæ•´ç†è³‡æ–™ã€‚');
        return;
      }
      if (n <= 0) {
        alert('è«‹è¼¸å…¥è¦æŠ½å‡ºçš„äººæ•¸ï¼ˆè‡³å°‘ 1 äººï¼‰ã€‚');
        return;
      }
      const count = Math.min(n, cleanEntries.length);
      const shuffled = shuffle(cleanEntries);
      const winners = shuffled.slice(0, count);

      winnerList.innerHTML = '';
      winners.forEach((rec, idx) => {
        const li = document.createElement('li');
        li.textContent = `${rec.orderId}ã€€${rec.snsName || ''}`;
        winnerList.appendChild(li);
      });

      if (count < n) {
        winnerHint.textContent = `åå–®åªæœ‰ ${cleanEntries.length} ç­†ï¼Œå¯¦éš›æŠ½å‡º ${count} ä½ã€‚`;
      } else {
        winnerHint.textContent = `å·²éš¨æ©ŸæŠ½å‡º ${count} ä½å¾—çè€…ã€‚`;
      }
    });
  </script>
</body>
</html>
